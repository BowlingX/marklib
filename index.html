---
layout: default
---
<header class="text-center">
    <h1>mark[lib</h1>

    <p class="subline" id="automark">Damn fast easy marking with serializable selections.</p>

    <a class="button alt" href="https://github.com/BowlingX/marklib"><i class="fa fa-github"></i> Fork me on Github</a>
</header>
<div class="presentation">
    <div class="wrapper">
        <h2>Try it</h2>

        <p>Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et
            dolore
            magna aliquyam erat, sed diam voluptua. <strong>At vero eos et accusam</strong> et justo duo dolores et ea
            rebum.
            Stet clita kasd
            gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolorasit amet, consetetur
            sadipscing
            elitr, sed diam nonumy eirmod tempor invidunt ut <i>labore</i> et dolore magna aliquyam erat, sed diam
            voluptua.
            At
            vero
            eos et accusam et justo duo <strong>dolores ea rebum. Stet</strong> clita kasd gubergren, no sea takimata
            sanctus est Lorem ipsum
            dolor sit amet.
        </p>

        <h2>A second paragraph</h2>

        <p>Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et
            dolore
            magna aliquyam erat, sed diam voluptua. <strong>At vero eos et accusam</strong> et justo duo dolores et ea
            rebum.
            Stet clita kasd
            gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolorasit amet, consetetur
            sadipscing
            elitr, sed diam nonumy eirmod tempor invidunt ut <i>labore</i> et dolore magna aliquyam erat, sed diam
            voluptua.
            At
            vero
            eos et accusam et justo duo <strong>dolores ea rebum. Stet</strong> clita kasd gubergren, no sea takimata
            sanctus est Lorem ipsum
            dolor sit amet.
        </p>
        <br>

        <div class="text-center">
            <button id="action-mark"><i class="fa fa-eraser"></i> Mark selection</button>
            <button class="warn" id="action-clear"><i class="fa fa-trash-o"></i></button>
        </div>
    </div>
</div>
<script type="text/javascript">
    document.addEventListener("DOMContentLoaded", function (event) {
        var STORAGE_KEY = 'savedRanges';

        var autoMarkText = document.getElementById('automark').childNodes[0];

        var render = function (autoMarkText, c) {
            var r = new Marklib(document, 'fadeInDown');
            var range = document.createRange();
            range.setStart(autoMarkText, 0);
            range.setEnd(autoMarkText, 1);
            r.renderWithRange(range);
            if (autoMarkText.parentNode.nextSibling) {
                autoMarkText = autoMarkText.parentNode.nextSibling.childNodes[0];
                setTimeout(function () {
                    render(autoMarkText, c++);
                }, 10 * c);
            }
        };

        render(autoMarkText, 1);

        var savedRanges = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];

        savedRanges.forEach(function (range) {
            var marker = new Marklib(document);
            try {
                marker.renderWithPath(range.startContainerPath + ";" + range.startOffset,
                        range.endContainerPath + ";" + range.endOffset)
            } catch (e) {
                console.warn("Could not render:", range);
            }

        });
        var actionMark = function () {
            var selection = document.getSelection(), renderer = new Marklib(document),
                    result = renderer.renderWithRange(selection.getRangeAt(0));
            selection.removeAllRanges();
            savedRanges.push(result);
            localStorage.setItem(STORAGE_KEY, JSON.stringify(savedRanges));
        };

        document.addEventListener("keydown", function (e) {
            if (13 === e.keyCode) {
                actionMark();
            }
        });

        document.addEventListener("click", function (e) {
            if (e.target.id === 'action-mark') {
                return actionMark();
            } else if (e.target.id === 'action-clear') {
                var elements = document.getElementsByTagName('x-marker');
                for(var i=0;i<elements.length;i++) {
                    elements[i].classList.add('deleted');
                }
                savedRanges = [];
                localStorage.setItem(STORAGE_KEY, JSON.stringify([]));
            }
        });
    });
</script>